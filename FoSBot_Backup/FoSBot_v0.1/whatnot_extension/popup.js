const cfgBtn=document.getElementById('configureButton');const statEl=document.getElementById('status');const selDiv=document.getElementById('currentSelectors');const wsStatEl=document.getElementById('ws-status');
function displaySelectors(){chrome.storage.local.get(['whatnotSelectors'],(r)=>{selDiv.innerHTML='<strong>Current:</strong><br>';if(r.whatnotSelectors){const k=['chatContainer','messageItem','username','messageText','chatInput','sendButton'];k.forEach(key=>{const d=document.createElement('div');const v=r.whatnotSelectors[key];d.textContent=`${key}: ${v||'N/A'}`;d.title=v||'N/A';selDiv.appendChild(d);});}else{selDiv.innerHTML+='<i>None saved.</i>';}});}
function checkConnection(){wsStatEl.textContent='WS: Chk...';chrome.tabs.query({active:true,currentWindow:true},(tabs)=>{const wt=tabs.find(t=>t.url&&t.url.includes('whatnot.com'));if(wt&&wt.id){chrome.tabs.sendMessage(wt.id,{action:"query_status"},(r)=>{if(chrome.runtime.lastError){wsStatEl.textContent=`WS: Err`;console.error(chrome.runtime.lastError.message);}else if(r){wsStatEl.textContent=`WS: ${r.ws_status||'?'}`;if(r.selectors_ok===false)statEl.textContent="WARN: Selectors missing!";else if(r.selectors_ok===true)statEl.textContent="Selectors loaded.";}else{wsStatEl.textContent='WS: No Resp';}});}});}
cfgBtn.addEventListener('click',()=>{statEl.textContent='Sending...';chrome.tabs.query({active:true,currentWindow:true},(tabs)=>{const wt=tabs.find(t=>t.url&&t.url.includes('whatnot.com'));if(wt&&wt.id){chrome.tabs.sendMessage(wt.id,{action:"start_inspector"},(r)=>{if(chrome.runtime.lastError){statEl.textContent=`Err: ${chrome.runtime.lastError.message}. Refresh?`;console.error(chrome.runtime.lastError);}else if(r&&r.status==="started"){statEl.textContent='Inspector started.';window.close();}else if(r&&r.status==="already_active"){statEl.textContent='Inspector active.';window.close();}else{statEl.textContent='Failed: No response.';console.warn(r);}});}});}
document.addEventListener('DOMContentLoaded',()=>{displaySelectors();checkConnection();});
